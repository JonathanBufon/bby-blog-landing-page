# Security Headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # HSTS (uncomment for production with HTTPS)
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# Disable directory browsing
Options -Indexes

# Block access to sensitive files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

<FilesMatch "(composer\.json|composer\.lock|package\.json|\.env)$">
    Require all denied
</FilesMatch>

# Use the front controller as index file
DirectoryIndex index.php

# Disable server signature
ServerSignature Off

# Enable rewrite engine
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect to URI without front controller
    RewriteCond %{REQUEST_URI}::$0 ^(/.+)/(.*)::\2$
    RewriteRule .* - [E=BASE:%1]

    # Redirect to front controller if not a file/directory
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ %{ENV:BASE}/index.php [L]
</IfModule>

# Deny access to all PHP files except index.php
<FilesMatch "\.php$">
    Require all denied
</FilesMatch>
<FilesMatch "index\.php$">
    Require all granted
</FilesMatch>
